(function(){var m;(function(){function c(e){var b=k[e];if(b)return b;if(!i[e])throw new Error("Module "+e+" not found");for(var g=i[e],h=g.deps||(g.length?["require","exports","module"]:[]),j=k[e]={},a=0;a<h.length;a++){var d=h[a];switch(d){case "require":d=function(f){if(f.charAt(0)==="."){for(f=e.substring(0,e.lastIndexOf("/")+1)+f;l!==f;){var l=f;f=f.replace(/\/[^\/]*\/\.\.\//,"/")}f=f.replace(/\/\.\//g,"/")}return c(f)};break;case "exports":d=j;break;case "module":b=d={exports:j};break;default:d=
c(d)}h[a]=d}j=g.apply(this,h);if(b&&b.exports!=k[e])j=b.exports;if(j)return k[e]=j;return k[e]}var i={},k={};m=function(e,b){for(var g=[],h=0;h<e.length;h++)g.push(c(e[h]));b.apply(c,g)};m.def=function(e,b,g){if(typeof b=="function")i[e]=b;else(i[e]=g).deps=b}})();m.def("lingwo_dictionary/annotation/Reader2",["jquery"],function(c){function i(a,d,f){old_fn=a[d];a[d]=function(){old_fn.apply(this,arguments);f()}}function k(a){var d={},f;for(f in a)d[f]=a[f];return d}function e(a,d){return function(){return a.apply(d,
arguments)}}var b,g,h=/MSIE 6/i.test(navigator.userAgent),j={layout:"docked"};g={popup:{setup:function(){b.bubbleNode.addClass("popup")},shutdown:function(){b.bubbleNode.removeClass("popup")},show:function(){var a=b.selectedNode,d=b.bubbleNode,f=a.offset(),l=f.left+a.width()/2-150;a=f.top+a.height()+40;f=c(document).width();if(l+300>f)l=f-300;if(l<0)l=0;d.show().css({left:l,top:a,height:""});if(h||d.height()>200)d.css({height:200})},hide:function(){b.bubbleNode.hide()}},docked:{_dock:null,_footer:null,
_footerId:null,_footerMargin:null,_positionBubble:function(){b.bubbleNode.show();var a=b.bubbleNode,d=this._dock.offset(),f=this._footer.offset().top;a.outerWidth();a.innerWidth();var l=a.outerHeight()-a.innerHeight(),n=Math.max(d.top-c(window).scrollTop()+1,0);f=Math.min(f-c(window).scrollTop()-n-this._footerMargin+1,c(window).height()-n)-l;a.css({left:d.left-c(window).scrollLeft(),top:n,height:f})},_drupalHack:false,setup:function(){b.bubbleNode.addClass("docked");this._dock=c("#lingwo-korpus-dock");
this._footerId=this._dock.attr("data-footer-id");this._footerMargin=this._dock.attr("data-footer-margin");this._footer=c("#"+this._footerId);var a=e(this._positionBubble,this);c(window).bind("scroll.lingwoReaderDocked",a);c(window).bind("resize.lingwoReaderDocked",a);if(!this._drupalHack){typeof window.Drupal!="undefined"&&Drupal.adminToolbar&&i(Drupal.adminToolbar,"setState",function(){if(b.layout===g.docked){b.bubbleNode.hide();setTimeout(a,500)}});this._drupalHack=true}b.setBubbleContent("<em>Click a work in the text to look it up in the dictionary.</em>");
setTimeout(a,0)},shutdown:function(){b.bubbleNode.removeClass("docked");this._dock=this._footerId=this._footerMargin=this._footer=null;c(window).unbind(".lingwoReaderDocked")},show:function(){},hide:function(){}}};return b={defaultLayouts:g,onLoad:function(){},config:null,bubbleNode:null,contentNode:null,selectedNode:null,shown:false,isSetup:false,layout:null,setup:function(a){if(typeof a=="undefined")a=k(j);this.config=a;if(this.config.layout=="docked"&&h)this.config.layout="popup";if(this.isSetup){this.layout.shutdown();
this.layout=null;this.isSetup=false}if(!this.bubbleNode)this.bubbleNode=c("<div></div>").attr("id","lingwo-korpus-entry-view-wrapper").appendTo(c("body")).hide();if(!this.contentNode)this.contentNode=c("<div></div>").attr("id","lingwo-korpus-entry-view").appendTo(this.bubbleNode);a=typeof this.config.layout=="string"?g[this.config.layout]:this.config.layout;a.setup();this.config.skipHoverEvents||this.setupHoverEvents();this.layout=a;this.isSetup=false},setupHoverEvents:function(){var a=this;c(".anno, .anno-anchor").unbind("mouseenter mouseleave").bind("mouseenter",
function(d){d=c(d.target);d.addClass("hover");if(d=a._getAnnoText(d))d.addClass("hover")}).bind("mouseleave",function(d){d=c(d.target);d.removeClass("hover");if(d=a._getAnnoText(d))d.removeClass("hover")})},_getAnnoText:function(a){if(a.hasClass("anno-anchor"))if(a=a.attr("data-anno"))return c("#"+a);return null},setSelection:function(a){var d;if(this.selectedNode){this.selectedNode.removeClass("selected");if(d=this._getAnnoText(this.selectedNode))d.removeClass("selected");this.selectedNode=null}if(a){a=
c(a);a.addClass("selected");this.selectedNode=a;if(d=this._getAnnoText(this.selectedNode))d.addClass("selected")}},clearSelection:function(){this.setSelection(null)},isInsideBubble:function(a){for(;a=a.parentNode;)if(a.id=="lingwo-korpus-entry-view")return true;return false},showBubble:function(){this.layout.show();this.shown=true},hideBubble:function(){this.layout.hide();this.shown=false},setBubbleContent:function(a){this.contentNode.html(a)},setBubbleLoading:function(){this.setBubbleContent("Loading...")},
isWordNode:function(a){return c(a).hasClass("anno")||c(a).hasClass("anno-anchor")},handleClick:function(a){if(this.isWordNode(a)){if(this.isInsideBubble(a))this.onLoad(c(a));else{this.setSelection(a);this.onLoad(this.selectedNode);this.showBubble()}return false}this.clearSelection();this.hideBubble()}}});m.def("lingwo_dictionary/annotation/Embed",["jquery","lingwo_dictionary/annotation/Reader2"],function(c,i){function k(b,g,h){var j;for(j in g)if(!h||typeof b[j]=="undefined")b[j]=g[j]}var e={};if(typeof window.BiblioBird!=
"undefined")e=window.BiblioBird;k(e,{url:"http://www.bibliobird.com",lang:"en",showLinks:true,ga:true},true);if(e.ga)e.ga=typeof window._gaq!="undefined";k(e,{initialized:false,contentAreas:[],embedWindow:null,embedIframe:null,embedWindowShown:false,username:null,start:function(){var b=this;c(".bibliobird-content").each(function(){b.contentAreas.push(new ContentArea(this))})},initialize:function(b){function g(){var a=(c(window).width()-400)/2,d=(c(window).height()-200)/2;h.css({top:d,left:a})}if(!this.initialized){var h=
c('<div class="clear-block"><div class="bibliobird-embed-titlebar"><span class="bibliobird-embed-title">BiblioBird</span> <a href="#" class="bibliobird-embed-close">close</a></div></div>'),j=c('<iframe height="100%" width="100%" border="0" id="bibliobirdEmbedIframe" name="bibliobirdEmbedIframe"></iframe>').appendTo(h);h.css({width:400,height:200,position:"fixed",border:"1px solid black",background:"white",display:"none"}).appendTo(c("body"));c(".bibliobird-embed-close",h).click(function(){e.hideEmbedWindow();
return false});c(window).resize(g);setTimeout(g,0);i.setup({layout:"popup",skipHoverEvents:true});c("body").click(function(a){e.hideEmbedWindow();return i.handleClick(a.target)});k(this,{embedWindow:h,embedIframe:j,username:b,initialized:true})}},receiveMessage:function(b){if(b.indexOf("#login-successful")==0){b=b.split(":");if(b[1])this.username=b[1];this.hideEmbedWindow()}},openEmbedWindow:function(b){if(this.embedWindow!==null&&!this.embedWindowShown){this.embedIframe.attr("src",b);this.embedWindow.show();
this.embedWindowShown=true}},hideEmbedWindow:function(){if(this.embedWindow!==null&&this.embedWindowShown){this.embedWindow.hide();this.embedWindowShown=false;this.refreshAll()}},logout:function(){var b=this;c.ajax({url:e.url+"/lingwo_korpus/rlogout",dataType:"jsonp",success:function(){b.username=null;b.refreshAll()}})},refreshAll:function(){c.each(this.contentAreas,function(){this.refresh()})}});i.onLoad=function(b){b=(b.attr("data-entry")||"").split("#");var g=b[0],h=b[1];i.setBubbleLoading();c.ajax({url:e.url+
"/lingwo_korpus/lookup_entry",dataType:"jsonp",data:{hash:g,lang:e.lang},success:function(j){i.setBubbleContent(j.content);e.ga&&_gaq.push(["_trackEvent","BiblioBird","Anonymous Lookup",e.lang]);c(".node",i.contentNode).removeClass("clear-block").removeAttr("id");c("ul.links.inline",i.contentNode).remove();h&&c(".lingwo-sense-id-"+h,i.contentNode).addClass("selected");c("a",i.contentNode).each(function(a,d){a=d.href;var f;if(a){f=window.location.protocol+"//"+window.location.host;d.href=a.replace(f,
e.url);d.target="_blank"}})}})};ContentArea=function(b){this.node=b;this.url=c(b).attr("data-url")||(""+window.location.href).split("#")[0];this.teaser=c(b).attr("data-teaser")=="true";this.links=c('<div class="bibliobird-links"></div>').insertBefore(b);this.data={};this.lookupContent()};k(ContentArea.prototype,{lookupContent:function(){var b=this;c.ajax({url:e.url+"/lingwo_korpus/lookup_content",dataType:"jsonp",data:{url:this.url},success:function(g){e.initialize(g.username);b.data=g;b.rebuildLinks();
if(g.content){b.node.innerHTML=g.content;i.setupHoverEvents()}}})},rebuildLinks:function(){if(e.showLinks){var b=this.links,g=this.data;b.html("");if(e.username){b.append("Logged into BiblioBird as "+e.username+" ");b.append(c("<a></a>").html("Logout").attr("href",e.url+"/logout").click(function(){e.logout();return false}))}else{b.append("Not logged into BiblioBird ");b.append(c("<a></a>").html("Login").attr("href",e.url+"/lingwo_korpus/rlogin"+(e.localRelayUrl?"?relay="+e.localRelayUrl:"")).click(function(h){e.openEmbedWindow(h.target.href);
return false}));b.append(" ");b.append(c("<a></a>").html("Join BiblioBird").attr({href:e.url+"/user/register",target:"_blank"}))}b.append(" ");g.not_found&&b.append(c("<a></a>").html("Add to Bibliobird").attr({href:e.url+"/node/add/content?remote_url="+escape(this.url),target:"_blank"}))}},refresh:function(){this.rebuildLinks()}});return window.BiblioBird=e});m.def("jquery",[],function(){return window.jQuery});m.def("jQuery",[],function(){return window.jQuery});m(["lingwo_dictionary/annotation/Embed"],
function(c){c.start()})})();
