(function(){var l;(function(){function c(d){var a=k[d];if(a)return a;if(!j[d])throw new Error("Module "+d+" not found");for(var e=j[d],h=e.deps||(e.length?["require","exports","module"]:[]),b=k[d]={},g=0;g<h.length;g++){var f=h[g];switch(f){case "require":f=function(i){if(i.charAt(0)==="."){for(i=d.substring(0,d.lastIndexOf("/")+1)+i;m!==i;){var m=i;i=i.replace(/\/[^\/]*\/\.\.\//,"/")}i=i.replace(/\/\.\//g,"/")}return c(i)};break;case "exports":f=b;break;case "module":a=f={exports:b};break;default:f=
c(f)}h[g]=f}b=e.apply(this,h);if(a&&a.exports!=k[d])b=a.exports;if(b)return k[d]=b;return k[d]}var j={},k={};l=function(d,a){for(var e=[],h=0;h<d.length;h++)e.push(c(d[h]));a.apply(c,e)};l.def=function(d,a,e){if(typeof a=="function")j[d]=a;else(j[d]=e).deps=a}})();l.def("lingwo_dictionary/annotation/Reader2",["jquery"],function(c){function j(b,g,f){old_fn=b[g];b[g]=function(){old_fn.apply(this,arguments);f()}}function k(b){var g={},f;for(f in b)g[f]=b[f];return g}function d(b,g){return function(){return b.apply(g,
arguments)}}var a,e,h={layout:"docked"};e={popup:{setup:function(){a.bubbleNode.addClass("popup")},shutdown:function(){a.bubbleNode.removeClass("popup")},show:function(){var b=a.selectedNode,g=a.bubbleNode,f=b.offset(),i=f.left+b.width()/2-150;b=f.top+b.height()+40;f=c(document).width();if(i+300>f)i=f-300;if(i<0)i=0;g.show().css({left:i,top:b,height:""});g.height()>200&&g.css({height:200})},hide:function(){a.bubbleNode.hide()}},docked:{_dock:null,_footer:null,_footerId:null,_footerMargin:null,_positionBubble:function(){a.bubbleNode.show();
var b=a.bubbleNode,g=this._dock.offset(),f=this._footer.offset().top;b.outerWidth();b.innerWidth();var i=b.outerHeight()-b.innerHeight(),m=Math.max(g.top-c(window).scrollTop()+1,0);f=Math.min(f-c(window).scrollTop()-m-this._footerMargin+1,c(window).height()-m)-i;b.css({left:g.left-c(window).scrollLeft(),top:m,height:f})},_drupalHack:false,setup:function(){a.bubbleNode.addClass("docked");this._dock=c("#lingwo-korpus-dock");this._footerId=this._dock.attr("data-footer-id");this._footerMargin=this._dock.attr("data-footer-margin");
this._footer=c("#"+this._footerId);var b=d(this._positionBubble,this);c(window).bind("scroll.lingwoReaderDocked",b);c(window).bind("resize.lingwoReaderDocked",b);if(!this._drupalHack){typeof window.Drupal!="undefined"&&Drupal.adminToolbar&&j(Drupal.adminToolbar,"setState",function(){if(a.layout===e.docked){a.bubbleNode.hide();setTimeout(b,500)}});this._drupalHack=true}a.setBubbleContent("<em>Click a work in the text to look it up in the dictionary.</em>");setTimeout(b,0)},shutdown:function(){a.bubbleNode.removeClass("docked");
this._dock=this._footerId=this._footerMargin=this._footer=null;c(window).unbind(".lingwoReaderDocked")},show:function(){},hide:function(){}}};return a={defaultLayouts:e,onLoad:function(){},config:null,bubbleNode:null,contentNode:null,selectedNode:null,shown:false,isSetup:false,layout:null,setup:function(b){if(typeof b=="undefined")b=k(h);this.config=b;if(this.isSetup){this.layout.shutdown();this.layout=null;this.isSetup=false}if(!this.bubbleNode)this.bubbleNode=c("<div></div>").attr("id","lingwo-korpus-entry-view-wrapper").appendTo(c("body")).hide();
if(!this.contentNode)this.contentNode=c("<div></div>").attr("id","lingwo-korpus-entry-view").appendTo(this.bubbleNode);b=typeof this.config.layout=="string"?e[this.config.layout]:this.config.layout;b.setup();this.layout=b;this.isSetup=false},setSelection:function(b){if(this.selectedNode){this.selectedNode.removeClass("selected");this.selectedNode=null}if(b){b=c(b);b.addClass("selected");this.selectedNode=b}},clearSelection:function(){this.setSelection(null)},showBubble:function(){if(!this.shown){this.layout.show();
this.shown=true}},hideBubble:function(){if(this.shown){this.layout.hide();this.shown=false}},setBubbleContent:function(b){this.contentNode.html(b)},setBubbleLoading:function(){this.setBubbleContent("Loading...")},isWordNode:function(b){return c(b).hasClass("anno")},handleClick:function(b){if(this.isWordNode(b)){this.setSelection(b);this.onLoad(this.selectedNode);this.showBubble();return false}this.clearSelection();this.hideBubble()}}});l.def("lingwo_dictionary/annotation/Embed",["jquery","lingwo_dictionary/annotation/Reader2"],
function(c,j){function k(a,e,h){var b;for(b in e)if(!h||typeof a[b]=="undefined")a[b]=e[b]}var d={};if(typeof window.BiblioBird!="undefined")d=window.BiblioBird;k(d,{url:"http://www.bibliobird.com",lang:"en"},true);k(d,{initialized:false,contentAreas:[],embedWindow:null,embedIframe:null,embedWindowShown:false,username:null,start:function(){var a=this;c(".bibliobird-content").each(function(){a.contentAreas.push(new ContentArea(this))})},initialize:function(a){function e(){var g=(c(window).width()-
400)/2,f=(c(window).height()-200)/2;h.css({top:f,left:g})}if(!this.initialized){var h=c('<div class="clear-block"><div class="bibliobird-embed-titlebar"><span class="bibliobird-embed-title">BiblioBird</span> <a href="#" class="bibliobird-embed-close">close</a></div></div>'),b=c('<iframe height="100%" width="100%" border="0" id="bibliobirdEmbedIframe" name="bibliobirdEmbedIframe"></iframe>').appendTo(h);h.css({width:400,height:200,position:"fixed",border:"1px solid black",background:"white"}).hide().appendTo(c("body"));
c(".bibliobird-embed-close",h).click(function(){d.hideEmbedWindow();return false});c(window).resize(e);setTimeout(e,0);j.setup({layout:"popup"});c("body").click(function(g){d.hideEmbedWindow();return j.handleClick(g.target)});k(this,{embedWindow:h,embedIframe:b,username:a,initialized:true})}},receiveMessage:function(a){if(a.indexOf("#login-successful")==0){a=a.split(":");if(a[1])this.username=a[1];this.hideEmbedWindow()}},openEmbedWindow:function(a){if(this.embedWindow!==null&&!this.embedWindowShown){this.embedIframe.attr("src",
a);this.embedWindow.show();this.embedWindowShown=true}},hideEmbedWindow:function(){if(this.embedWindow!==null&&this.embedWindowShown){this.embedWindow.hide();this.embedWindowShown=false;this.refreshAll()}},logout:function(){var a=this;c.ajax({url:d.url+"/lingwo_korpus/rlogout",dataType:"jsonp",success:function(){a.username=null;a.refreshAll()}})},refreshAll:function(){c.each(this.contentAreas,function(){this.refresh()})}});j.onLoad=function(a){var e=a.attr("data-sense");j.setBubbleLoading();c.ajax({url:d.url+
"/lingwo_korpus/lookup_entry",dataType:"jsonp",data:{url:a.attr("href")},success:function(h){j.setBubbleContent(h.content);c(".node",j.contentNode).removeClass("clear-block").removeAttr("id");c("ul.links.inline",j.contentNode).remove();e&&c(".lingwo-sense-id-"+e,j.contentNode).addClass("selected");c("a",j.contentNode).each(function(b,g){b=g.href;var f;if(b){f=window.location.protocol+"//"+window.location.host;g.href=b.replace(f,d.url);g.target="_blank"}})}})};ContentArea=function(a){this.node=a;this.from_lang=
c(a).attr("data-from-lang");this.to_lang=c(a).attr("data-to-lang");this.url=c(a).attr("data-url")||window.location.href;this.teaser=c(a).attr("data-teaser")=="true";this.links=c('<div class="bibliobird-links"></div>').insertBefore(a);this.data={};this.lookupContent()};k(ContentArea.prototype,{lookupContent:function(){var a=this;c.ajax({url:d.url+"/lingwo_korpus/lookup_content",dataType:"jsonp",data:{url:this.url,to_lang:this.to_lang},success:function(e){d.initialize(e.username);a.data=e;a.rebuildLinks();
if(e.content)a.node.innerHTML=e.content}})},rebuildLinks:function(){var a=this.links,e=this.data;a.html("");if(d.username){a.append("Logged into BiblioBird as "+d.username+" ");a.append(c("<a></a>").html("Logout").attr("href",d.url+"/logout").click(function(){d.logout();return false}))}else{a.append("Not logged into BiblioBird ");a.append(c("<a></a>").html("Login").attr("href",d.url+"/lingwo_korpus/rlogin"+(d.localRelayUrl?"?relay="+d.localRelayUrl:"")).click(function(h){d.openEmbedWindow(h.target.href);
return false}));a.append(" ");a.append(c("<a></a>").html("Join BiblioBird").attr({href:d.url+"/user/register",target:"_blank"}))}a.append(" ");e.not_found&&a.append(c("<a></a>").html("Add to Bibliobird").attr({href:d.url+"/node/add/content?remote_url="+escape(this.url),target:"_blank"}))},refresh:function(){this.rebuildLinks()}});return window.BiblioBird=d});l.def("jquery",[],function(){return window.jQuery});l.def("jQuery",[],function(){return window.jQuery});l(["lingwo_dictionary/annotation/Embed"],
function(c){c.start()})})();
