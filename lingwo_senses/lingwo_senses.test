<?php

require_once(drupal_get_path('module', 'lingwo_dictionary') .'/lingwo_dictionary.test.inc');

class LingwoSensesTestCase extends LingwoDictionaryWebTestCase {
  private $pos_terms;

  public static function getInfo() {
    return array(
      'name' => 'lingwo_senses',
      'description' => 'Testing the web functionality provided by lingwo_senses.',
      'group' => 'Lingwo Dictionary',
    );
  }

  public function setUp() {
    parent::setUp('lingwo_senses');

    $entry_type = lingwo_dictionary_entry_content_type();

    // add the lingwo_senses CCK field to the entry content type
    $edit = array(
      '_add_new_field[label]'       => 'Senses',
      '_add_new_field[field_name]'  => 'senses',
      '_add_new_field[type]'        => 'lingwo_senses',
      '_add_new_field[widget_type]' => 'lingwo_senses_widget',
    );
    $this->drupalPost('admin/content/node-type/'. $entry_type .'/fields', $edit, 'Save');
    $this->drupalPost(NULL, array('multiple' => 1), 'Save field settings');
  }

  // TODO: build out with cases from senses-use-cases.rst
  public function testSingleSense() {
    $entry_type = lingwo_dictionary_entry_content_type();

    // create the entry
    $this->createEntry(array(
      'headword' => 'czerwony',
      'language' => 'pl',
      'pos' => 'Adjective'
    ));
    $this->assertText(t('@type czerwony has been created.', array('@type' => $entry_type)));

    // get the node id from the URL
    // TODO: we should use the {lingwo_dictionary_entry} table to get this information
    if (!preg_match('/node\/(\d+)/', $this->url, $matches)) {
      $this->fail("Couldn't get the node ID from the URL: ". $this->url);
      return;
    }
    $nid = $matches[1];

    // add a translation
    // TODO: set some data in the translation
    $trans = array(
    );
    $this->drupalPost('node/add/'. $entry_type, $trans, 'Save', array(
      'query' => array(
        'translation' => $nid,
        'language' => 'en'
      )
    ));
    $this->assertText(t('@type czerwony has been created.', array('@type' => $entry_type)));
  }
}

